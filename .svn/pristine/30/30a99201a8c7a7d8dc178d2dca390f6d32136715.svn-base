<template>
  <div id="app">
    <router-view></router-view>
  </div>
</template>

<script>
import storage from 'good-storage'
import { mapMutations } from 'vuex'
export default {
  name: 'app',
  created () {
    if (!window._dataInfo) {
      storage.get('_dataInfo') && (window._dataInfo = JSON.parse(storage.get('_dataInfo')))
    }
    this._getPost()
  },
  methods: {
    _getPost () {
      if (window._dataInfo) {
          this.$http.get('http://mp.17link.cc/worker/postDict').then(res => {
          this.SET_POST(res.data.data.list)
        }).catch(e => {
          this.$store.dispatch('LogOut').then(() => {
            location.reload() // 为了重新实例化vue-router对象 避免bug
          })
        })
      }
    },
    ...mapMutations([
      'SET_POST'
    ])
  }
}
</script>

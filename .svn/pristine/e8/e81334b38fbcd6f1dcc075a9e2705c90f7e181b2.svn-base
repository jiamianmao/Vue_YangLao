webpackJsonp([4],{"/lui":function(e,t,r){"use strict";var i={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"date-box"},[r("el-form-item",{attrs:{label:"请选择服务时间"}},[r("el-radio-group",{attrs:{size:"big",max:1},on:{change:e.selectDate},model:{value:e.checked,callback:function(t){e.checked=t},expression:"checked"}},e._l(e.dateList,function(t){return r("el-radio-button",{key:t.date,attrs:{label:t.date,disabled:1===t.isFull}},[e._v("\n                    "+e._s(t.weekInfo+"("+t.dateStr+")")+"\n                ")])}))],1)],1)},staticRenderFns:[]};var n=r("/Xao")({name:"dateBox",props:["dateList"],data:function(){return{checked:""}},created:function(){},methods:{selectDate:function(){this.$emit("date-select",this.checked)}},watch:{}},i,!1,function(e){r("MB1O")},null,null);t.a=n.exports},"2GU/":function(e,t,r){(e.exports=r("BkJT")(!1)).push([e.i,"",""])},"8OnN":function(e,t,r){var i=r("2GU/");"string"==typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);r("8bSs")("5ae8586a",i,!0)},MB1O:function(e,t,r){var i=r("dz6H");"string"==typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);r("8bSs")("67556c50",i,!0)},NkTz:function(e,t,r){(e.exports=r("BkJT")(!1)).push([e.i,'\n.order-ress {\n  font-family: "PingFang SC", "Microsoft YaHei", "\\5FAE\\8F6F\\96C5\\9ED1", "Helvetica Neue", Helvetica, "PingFang SC", "Hiragino Sans GB", Arial, sans-serif;\n  font-size: 14px;\n  padding-left: 20px;\n}\n.order-ress .categories .m-pos h5 {\n    margin-left: 20px;\n}\n.order-ress .m-pos {\n    margin: 20px 0px;\n}\n',""])},O2qk:function(e,t,r){"use strict";var i={name:"timeBox",props:["useTime","costTime","curTime"],data:function(){return{disabledTime:this.useTime,showTime:["08:00","08:30","09:00","09:30","10:00","10:30","11:00","11:30","12:00","12:30","13:00","13:30","14:00","14:30","15:00","15:30","16:00","16:30","17:00","17:30","18:00","18:30","19:00","19:30"],clickNum:"",needNum:"",baseNum:17,flag:!0}},created:function(){this.costTime&&(this.needNum=Math.ceil(this.costTime/30))},methods:{chose:function(e){this.clickNum=e},sendMessage:function(){var e=this.needNum+this.clickNum,t=this.showTime[this.clickNum],r=this.showTime[e];24===e&&(r="20:00");var i=t+"至"+r,n=new Date(this.curTime),a=n.getFullYear()+"-"+(n.getMonth()+1)+"-"+n.getDate()+" "+t,o=n.getFullYear()+"-"+(n.getMonth()+1)+"-"+n.getDate()+" "+r;t||(i=""),this.$emit("choose-time",new Date(a).getTime(),new Date(o).getTime(),i)}},watch:{costTime:function(){this.costTime&&(this.needNum=Math.ceil(this.costTime/30)),0===this.costTime&&(this.needNum=0,this.clickNum="",console.log(this.needNum))},useTime:function(){this.disabledTime=this.useTime}},directives:{myclick:{update:function(e,t,r){var i=parseInt(e.dataset.need),n=parseInt(t.value),a=i+n,o=e.children;if(""===i||void 0===i||void 0===n||null===n)return!1;for(var s=0;s<24;s++)o[s].className=o[s].className.replace("choose","");if(a>24){for(var c=0;c<24;c++)o[c].className=o[c].className.replace("choose","");return!1}for(var l=n;l<a;l++){if(-1!==o[l].className.indexOf("used")){for(var d=0;d<24;d++)o[d].className=o[d].className.replace("choose","");return alert("该段时间不可用请重新选择时间"),!1}o[l].className+="choose"}r.context.sendMessage()}}}},n={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("ul",{directives:[{name:"myclick",rawName:"v-myclick",value:e.clickNum,expression:"clickNum"}],staticClass:"clearfix",attrs:{"data-need":e.needNum}},e._l(24,function(t){return r("li",{class:{used:-1!==e.disabledTime.indexOf(t+16)},attrs:{num:t},on:{click:function(r){e.chose(t-1)}}},[e._v(e._s(e.showTime[t-1]))])}))])},staticRenderFns:[]};var a=r("/Xao")(i,n,!1,function(e){r("s5PY")},"data-v-30274aa2",null);t.a=a.exports},"Z8O/":function(e,t,r){"use strict";var i={name:"checkGroup",props:["data","ifNew","num","displayed"],data:function(){return{cates:[],checkList:[],cateP:"",productList:[]}},components:{},created:function(){console.log(this.data)},methods:{sendData:function(e){this.$emit("checked",e,this.num)},checked:function(e){var t=this;this.productList=[];for(var r=0,i=0,n=this.data.filter(function(e){return e.catePid===t.cateP})[0],a=function(a){var o=t.cates.filter(function(t){return t.id===e[a]})[0];o&&(t.productList.push(o),r+=o.serviceDuration,i+=o.price,o.duration=o.serviceDuration,o.catePid=n.catePid,o.catePname=n.catePname)},o=0;o<e.length;o++)a(o);this.sendData({price:i,time:r,productList:this.productList})},selected:function(){this.productList=[],this.checkList=[],this.$emit("group-selected",this.cateP,this.num)}},watch:{cateP:function(){var e=this;this.cates=this.data.filter(function(t){return t.catePid===e.cateP})[0].product},checkList:function(){var e=this;this.productList=[];for(var t=0,r=0,i=this.data.filter(function(t){return t.catePid===e.cateP})[0],n=this.checkList,a=function(a){var o=e.cates.filter(function(e){return e.id===n[a]})[0];o&&(e.productList.push(o),t+=o.serviceDuration,r+=o.price,o.duration=o.serviceDuration,o.catePid=i.catePid,o.catePname=i.catePname)},o=0;o<n.length;o++)a(o);console.log(this.productList),console.log(this.checkList),this.sendData({price:r,time:t,productList:this.productList})}}},n={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("el-select",{attrs:{filterable:"",placeholder:"请选择",disabled:e.displayed},on:{change:e.selected},model:{value:e.cateP,callback:function(t){e.cateP=t},expression:"cateP"}},e._l(e.data,function(e){return r("el-option",{key:e.value,attrs:{label:e.cateName,value:e.catePid}})})),e._v(" "),r("el-checkbox-group",{on:{change:e.checked},model:{value:e.checkList,callback:function(t){e.checkList=t},expression:"checkList"}},e._l(e.cates,function(t){return r("el-checkbox",{key:t.id,attrs:{label:t.id}},[e._v(e._s(t.cateName))])}))],1)},staticRenderFns:[]};var a=r("/Xao")(i,n,!1,function(e){r("8OnN")},null,null);t.a=a.exports},dz6H:function(e,t,r){(e.exports=r("BkJT")(!1)).push([e.i,"\n.date-box {\n  background-color: #efefef;\n}\n",""])},s5PY:function(e,t,r){var i=r("vUN+");"string"==typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);r("8bSs")("0d788133",i,!0)},"vUN+":function(e,t,r){(e.exports=r("BkJT")(!1)).push([e.i,"\nul[data-v-30274aa2] {\n  width: 50%;\n  padding-left: 120px;\n}\nul li[data-v-30274aa2] {\n    width: 106px;\n    height: 32px;\n    line-height: 30px;\n    font-size: 18px;\n    float: left;\n    text-align: center;\n    border: 1px solid #efefef;\n    text-align: center;\n    background-color: #fff;\n}\nul li[data-v-30274aa2]:hover {\n    cursor: pointer;\n}\n.choose[data-v-30274aa2] {\n  background-color: #20A0FF;\n}\n.used[data-v-30274aa2] {\n  background-color: #efefef;\n}\n",""])},y05p:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r("cUn4"),n=r.n(i),a=r("lC5x"),o=r.n(a),s=r("J0Oq"),c=r.n(s),l=r("Z8O/"),d=r("/lui"),u=r("O2qk"),h=r("rppN"),f={data:function(){return{orgId:window._dataInfo.orgId,orgName:window._dataInfo.orgName,loading:!0,orderId:"",orderForm:{orderId:"",workerId:"",workerName:"",workerMobile:"",serviceTime:"",remark:"",source:1},info:{},amount:"",balance:"",totleTime:0,totlePrice:0,serPeople:[],workerPostDict:"",serId:"",dateList:[],curTime:"",usedTime:[],showDialog:!1,showTime:"",source:""}},components:{checkGroup:l.a,dateBox:d.a,timeBox:u.a,PageContainer:h.a},created:function(){try{this.orderId=this.$route.query.orderId,this.source=this.$route.query.source,this.getOrderInfo(),this.getAllSerPeople(),this.getWorkerPostDict()}catch(e){console.log(e)}},methods:{getOrderInfo:function(){var e=this;return c()(o.a.mark(function t(){var r,i;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.$http.get("http://mp.17link.cc/order/distribute/info?orderId="+e.orderId);case 3:r=t.sent,i=r.data.data,e.info=i,e.totleTime=e.info.duration,e.totlePrice=e.info.price,e.serId=e.info.workerId,e.getDateList(e.serId),t.next=15;break;case 12:t.prev=12,t.t0=t.catch(0),console.log(t.t0);case 15:case"end":return t.stop()}},t,e,[[0,12]])}))()},submit:function(){var e=this;if(this.info.price>this.info.balance)return alert("余额不足，无法提交订单！"),!1;if(!this.orderForm.serviceTime)return alert("请选择服务开始时间"),!1;var t=this,r=this.serPeople.filter(function(e){return e.id===t.serId})[0];this.orderForm.orderId=this.orderId,this.orderForm.workerId=r.id,this.orderForm.workerName=r.name,this.orderForm.workerMobile=r.mobile,this.$http.post("http://mp.17link.cc/order/distributeOrder",this.orderForm).then(function(t){e.$router.go(-1)}).catch(function(e){return alert(e)})},getProducts:function(){var e=this;this.$http.get("http://mp.17link.cc/manage/category/loadByOrgId").then(function(t){e.groupData=[],e.groupData.push(t.data.data.list)}).catch(function(e){return console.log})},getAllSerPeople:function(){var e=this;return c()(o.a.mark(function t(){var r,i,n;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,r=e,t.next=4,e.$http.get("http://mp.17link.cc/worker/getworkerByOrg?orgId="+e.orgId);case 4:if(i=t.sent,n=i.data.data,e.serPeople=n.list,e.serPeople.length){t.next=9;break}return t.abrupt("return",!1);case 9:e.serPeople.forEach(function(e){return e._userShowInfo=e.name+" "+r.workerPostDict.get(e.post)}),t.next=15;break;case 12:t.prev=12,t.t0=t.catch(0),alert(t.t0);case 15:case"end":return t.stop()}},t,e,[[0,12]])}))()},getWorkerPostDict:function(){var e=this;return c()(o.a.mark(function t(){var r,i,a;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,e.workerPostDict=new n.a,r=e,t.next=5,e.$http.get("http://mp.17link.cc/worker/postDict");case 5:i=t.sent,(a=i.data.data).post&&a.post.forEach&&a.post.forEach(function(e){return r.workerPostDict.set(e.id,e.text)}),t.next=13;break;case 10:t.prev=10,t.t0=t.catch(0),console.log(t.t0);case 13:case"end":return t.stop()}},t,e,[[0,10]])}))()},getDateList:function(e){var t=this;this.$http.get("http://mp.17link.cc/worker/futureTwoWeekDate?workerId="+e+"&duration="+this.totleTime).then(function(e){var r=e.data.data;t.dateList=r}).catch(function(e){return console.log})},getSerTime:function(e){var t=this;this.curTime=e,this.$http.get("http://mp.17link.cc/worker/holdingTime?workerId="+this.serId+"&date="+e).then(function(e){var r=e.data.data;t.usedTime=r,t.usedTime=[],Array.prototype.push.apply(t.usedTime,r)}).catch(function(e){return console.log})},chooseSerTime:function(e,t,r){this.orderForm.serviceTime=e,this.showTime=r}},watch:{serId:function(){this.getDateList(this.serId)}}},m={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("page-container",{attrs:{title:"订单改派","if-show":""}},[r("div",{staticClass:"order-ress"},[r("el-form",{ref:"form",attrs:{model:e.orderForm,"label-width":"120px",labelPosition:"left"}},[r("el-row",[r("el-col",{attrs:{span:7}},[e._v("\n                    老人姓名: "+e._s(e.info.userName)+"\n                ")]),e._v(" "),r("el-col",{attrs:{span:12}},[e._v("\n                    总额度: "+e._s(e.info.amount)+"元 当前剩余："+e._s(e.info.balance)+"元\n                ")])],1),e._v(" "),r("el-row",{staticClass:"address-info m-pos"},[r("el-col",{attrs:{span:7}},[e._v("\n                    请选择服务地址 : "+e._s(e.info.provinceName+e.info.cityName+e.info.districtName+e.info.streetName+e.info.detailedAddress+e.info.community+e.info.detailedAddress)+"\n                ")])],1),e._v(" "),r("el-row",{staticClass:"categories m-pos"},[r("el-col",{attrs:{span:7}},[e._v("\n                    服务品类：\n                    "),e._l(e.info.parentCates,function(t){return r("div",{key:t.id},[r("h5",[e._v("\n                            大品类：\n                            "),r("el-tag",{attrs:{type:"gray"}},[e._v(e._s(" "+t.cate.name+" "))])],1),e._v(" "),r("div",[e._v("\n                            小品类：\n                            "),e._l(t.products,function(t){return r("el-tag",{key:t.id,attrs:{type:"success"}},[e._v("\n                                "+e._s(t.cateName)+"\n                            ")])})],2)])})],2)],1),e._v(" "),r("el-row",{staticClass:"totle m-pos"},[r("div",[e._v("\n                    服务时长合计: "+e._s(e.info.duration)+"分钟\n                ")]),e._v(" "),r("div",[e._v("\n                    订单总额   : "+e._s(e.info.price)+"元\n                ")])]),e._v(" "),r("el-row",[r("el-col",{attrs:{span:7}},[r("el-form-item",{attrs:{label:"请选择服务人员"}},[r("el-select",{attrs:{placeholder:"请选择服务人员"},model:{value:e.serId,callback:function(t){e.serId=t},expression:"serId"}},e._l(e.serPeople,function(e){return r("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}))],1)],1)],1),e._v(" "),r("el-row",[r("date-box",{attrs:{dateList:e.dateList},on:{"date-select":e.getSerTime}})],1),e._v(" "),r("el-row",[r("time-box",{attrs:{curTime:e.curTime,costTime:this.totleTime,useTime:e.usedTime},on:{"choose-time":e.chooseSerTime}}),e._v(" "),r("div",{staticClass:"serTime m-pos"},[r("div",[e._v("选择的服务时间为:"+e._s(e.showTime))])])],1),e._v(" "),r("el-row",[r("el-form-item",{attrs:{label:"请填写备注信息"}},[r("el-input",{attrs:{type:"textarea"},model:{value:e.orderForm.remark,callback:function(t){e.$set(e.orderForm,"remark",t)},expression:"orderForm.remark"}})],1)],1)],1),e._v(" "),r("el-button",{on:{click:e.submit}},[e._v("改派")])],1),e._v(" "),e.showDialog?r("add-address",{on:{"pop-click":e.dialogClick}}):e._e()],1)},staticRenderFns:[]};var p=r("/Xao")(f,m,!1,function(e){r("zDb4")},null,null);t.default=p.exports},zDb4:function(e,t,r){var i=r("NkTz");"string"==typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);r("8bSs")("41344629",i,!0)}});
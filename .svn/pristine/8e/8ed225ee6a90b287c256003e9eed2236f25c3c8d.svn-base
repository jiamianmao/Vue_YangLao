<template>
    <div id="container" v-loading.body="loading"></div>
</template>
<script>
    export default {
        data() {
            return {
                center: "",
                list: [],
                loading: false
            };
        },
        async created(){
            this.loading = true;
            try {
                let { list , center } = await this.$http.get('/org/position');
                this.center = center.split(",");
                list.forEach(v=>v.position = v.position.split(","));
                this.list = list;
                this.drowMap();
            } catch (e) {
                console.log(e);
            }
        },
        methods: {
            drowMap(){
                console.log(this.center);
                console.log(this.list);
                let map = new AMap.Map('container', {
                    resizeEnable: true,
                    zoom:11,
                    center: this.center
                });

                for(let i=0;i<this.list.length;i++){
                    let marker = new AMap.Marker({
                        position: this.list[i].position,
                        title: this.list[i].title
                    });
                    marker.setMap(map);
//                    marker.setLabel({//label默认蓝框白底左上角显示，样式className为：amap-marker-label
//                        offset: new AMap.Pixel(20, 20),//修改label相对于maker的位置
//                        content: this.list[i].title
//                    });
                }

                map.plugin(["AMap.ToolBar"], function() {
                    map.addControl(new AMap.ToolBar());
                });

                let _this = this;
                map.on('complete', function() {
                    _this.loading = false;
                });
            },
        }
    };
</script>
<style lang="scss" scoped>
    #container{
        height: 100%;
        width: 100%;
        margin: 0 auto;
    }
</style>
